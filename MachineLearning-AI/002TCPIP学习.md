# 开源协议栈

[TOC]

DPDK  mTCP   SeaStar  lwIP   f-stack  LLVM

如何评价腾讯开源的基于 DPDK 和 BSD 协议栈

的网络框架 f-stack？

https://github.com/F-Stack/f-stack

关于SeaStar与f-stack的比较， [@彭健](https://www.zhihu.com/people/cf85dacb1eb364cbd90180d02ed4bae4) 的答案写的很好。在原来授权DNS的TCP协议栈基础上实现了较为完整的TCP/IP协议栈(参考了**mTCP,SeaStar,lwIP**等)，加上了协程框架，并且上层兼容了腾讯SNG的服务端框架SPP，使得腾讯云原有的业务可以无缝迁入，但是经过近一年的线上使用运行，我们发现，线上的网络环境各式各样，这个TCP/IP协议栈并不能满足全部需求(各种tunnel等)，而自己去实现各种协议既费力又不讨好，所以经过一段时间的调研，决定移植FreeBSD的协议栈。使用**POSIX**协议栈，这样的话就不走DPDK，而走内核协议栈。**SeaStar**的TCP/IP协议栈的实现只适合在内网运行，公网复杂的网络环境会导致它出现各种问题，作者回复邮件说过只在LAN下测过，没有在WAN上测试过，这也和SeaStar作为ScyllaDB的子项目的使用场景是相关的（包括上面答案中提到的的Redis项目），数据库不会暴露在外网使用

 f-stack：纯c实现，是一个胶水，粘合了DPDK,FreeBSD协议栈，POSIX API，上层应用(协程框架，Nginx,Redis)。使用了完整的FreeBSD协议栈，意味着有大量工具可以对网络进行调试分析,目前我们的重点就是移植这些工具，现在已经完成了sysctl的移植，欢迎各位提pr。

## *nux平台上的C10M问题

http://www.lenky.info/archives/2013/07/2320



# 无线网络

wifi locator软件，inSSIDer软件

下表是常用的 2.4GHz（=2400MHz）频带的信道划分。实际一共有[14个信道](http://en.wikipedia.org/wiki/List_of_WLAN_channels#Interference_Concerns)（下面的图中画出了第14信道），但第14信道一般不用。表中只列出信道的中心频率。每个信道的有效宽度是 20MHz，另外还有2MHz的强制隔离频带（类似于公路上的隔离带）。即，对于中心频率为 2412 MHz 的1信道，其频率范围为 2401~2423MHz。

| 信道   | 中心频率    | 信道   | 中心频率    |
| ---- | ------- | ---- | ------- |
| 1    | 2412MHz | 8    | 2447MHz |
| 2    | 2417MHz | 9    | 2452MHz |
| 3    | 2422MHz | 10   | 2457MHz |
| 4    | 2427MHz | 11   | 2462MHz |
| 5    | 2432MHz | 12   | 2467MHz |
| 6    | 2437MHz | 13   | 2472MHz |
| 7    | 2442MHz |      |         |

从下图很容易看到其中 1、6、11 这三个信道（红色标记）之间是完全没有交叠的，也就是人们常说的三个不互相重叠的信道。每个信道 20MHz 带宽。图中也很容易看清楚其他各信道之间频谱重叠的情况。

![IEEE_802.11b_DSSS_Channel_Allocations](https://cnzhx.net/wp-content/uploads/2012/12/IEEE_802.11b_DSSS_Channel_Allocations.jpg)

​				IEEE 802.11b DSSS 信道划分（图来自 CISCO）

另外，如果设备支持，除 1、6、11 三个一组互不干扰的信道外，还有 2、7、12；3、8、13；4、9、14 三组互不干扰的信道。现在新式的无线路由器都可以自动跳转信道了，但是巧妇难为无米之炊，设备多了，还是会遭遇干扰。所以很多设备开始使用 5GHz 附近（5.15~5.85GHz）的频带。该频段在划分时，每个信道与相邻信道都不发生重叠，因而干扰较小。但是也有缺点：5GHz 频率较高，在空间传输时衰减较为严重，因而如果距离稍远，性能会严重降低。

## wifi接入原理——scanning

扫描类型分两种，一种是主动扫描（active scanning），另一种是被动扫描（passivescanning）

### **1、 主动扫描（activescanning）**

​        我们先来说说主动扫描。即我们的手机（工作站STA）以主动的方式，在每个信道上发出Probe Request帧，请求某个特定无线网络予以回应。主动扫描是主动寻找网络，而不是静候无线网络声明本身的存在。使用主动扫描的工作站将会以如下的程序扫描信道表所列的频道：

​        （1）跳至某个信道，然后等候来帧指示（indicationof an incoming frame）或者等到ProbeDelay定时器超时。如果在这个信道收到帧，就证明该信道有用户在使用，因此可以加以探测。而ProbeDelay定时器可用来防止某个闲置信道让整个过程停止，因为工作站不会一直等待帧的到来。

​        （2）利用基本的DCF访问过程取得媒介使用权，然后送出一个Probe Request帧。

​        （3）至少等候一段最短的信道时间（即MinChannelTime）。

​        a.如果媒介并不忙碌，表示没有网络存在，因此可以跳至下个信道。

​        b.如果在MinChannelTime这段期间媒介非常忙碌，就继续等候一段时间，直到最长的信道时间（即MaxChannelTime）超时，然后处理任何的Probe Response帧。

​         大家可能会发现当手机进行WIFI热点搜索时，有时时间会比较长，原因是你处在的区域存在多个接入点（AP），当手机发出Probe Request帧时，多个接入点（AP）通过竞争窗口（congestionwindow）回应Probe Response帧，而这个竞争过程受限于最长的信道时间（即MaxChannelTime）。

​        当无线网络收到搜寻其所属的扩展服务集（ESS）的Probe Request时，就会发出Probe Response帧。若要找到附近所有的无线网络，那么Probe Request帧可使用broadcastSSID，如此一来，该区所有的802.11无线网络都会以Probe Response加以回应。

### **2、 被动扫描（passivescanning）**

​        现在大部分移动电子产品都是采用被动扫描（passive scanning）的方式，原因是扫描过程中不需要传送任何信号，可以省电。在被动扫描中，工作站会在信道列表（channel list）所列的各个信道之间不断切换，并静候Beacon帧的到来。所收到的任何帧都会被暂存起来，以便取出传送这些帧的BSS 的相关数据。

​        在被动扫描的过程中，工作站会在信道间不断切换，并且会记录来自所收到的任何Beacon的信息。Beacon在设计上是为了让工作站知道加入某个基本服务集（Basic Service Set，简称 BSS）所需要的参数以便进行通信。在下图中，通过监听来自前三个接入点的Beacon帧，移动式工作站以被动扫描找出该区所有BSS。如果该工作站并未收到来自第四个接入点的Beacon，就会汇报目前只发现的三个BSS。

![img](http://img.blog.csdn.net/20141011150055579?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvUmlnaHRoZWs=/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast)

扫描（Scanning）、认证（Authentication）、关联（Association）

## wifi接入原理——Authentication

注意：您选择的WEP加密经常在老的无线网卡上使用，新的802.11n不支持此加密方式。所以，如果您选择了此加密方式，路由器可能工作在较低的传输速率上。建议使用WPA2-PSK等级的AES加密。当代正在使用的WPA/WPA2加密方式，特别是倾向于家庭网络的WPA-PSK/WPA2-PSK。无线网络所使用的媒介是经过特殊编码与调制过的无线电波链路。它是众所周知的开放标准，只要对无线传输有所研究和了解的人，都可以在无线覆盖范围内发送和接收信号。因此对数据的拦劫和非法灌注是多么的简单！

早期的IEEE802.11定义了两种认证方式：

​        （1）开放系统认证（OpenSystem authentication）；

​        （2）共享密钥认证（SharedKey authentication）。

开放系统认证是IEEE802.11默认的认证方式，实质上并没有做认证。连接无线网络时，基站并没有验证工作站的真实身份。认证过程由以下两个步骤组成：第一，工作站发送身份声明和认证请求；第二，基站应答认证结果，如果返回的结果是“successful”，表示两者已相互认证成功。共享密钥认证：WPA（Wi-Fi Protected Access）是WIFI联盟制定的安全性标准，WPA2是第二个版本。PSK（PreShared Key）叫做预共享密钥。WPA-PSK/WPA2-PSK主要是针对个人或家庭网络等，对安全性要求不是很高的用户。而WPA /WPA2是针对企业的，对安全性要求很高的用户，在WPA/WPA2选项中，大家可以看到它比WPA-PSK/WPA2-PSK多了一个Radius服务器，这个就是认证服务器。

**1、WPA-PSK**

​        WPA-PSK（Wi-Fi ProtectedAccess，Wi-Fi保护访问）是WiFi联盟推出的标准，它是为兼容原有的WEP硬件产品，所以它采用的模式是：

WPA-PSK = PSK + TKIP + MIC

​        PSK：PreShared Key，预共享密钥。

​        TKIP：Temporal KeyIntegrity Protocol，临时密钥完整性协议。

​        MIC：Message IntegrityCode，消息完整性校验码。

​        TKIP的开发目的是为了提高原有的基于WEP硬件的安全性，因此它和WEP一样都是采RC4加密算法，同时保留了WEP的基本结构和操作方式。TKIP是一种过渡的加密协议，现已被证明安全性不高。因此，我们就不去详细的讲解了。

**2、WPA2-PSK**

​        WPA2是在802.11i颁布之后，WIFI联盟随即推出的最新无线安全标准，它遵循802.11i标准，以下是它采用的模式：

WPA2-PSK= PSK + AES + CCMP

​        PSK：PreShared Key，预共享密钥，它是一种802.11身份验证方式，以预先设定好的静态密钥进行身份验证，此密钥必须手动进行传递，即是我们的手机连接WIFI热点时需要输入的密码。

​        AES：Advanced EncryptionStandard，高级加密标准。AES是美国NIST制定的替代DES的分组加密算法。AES具有优秀的密钥扩展方案，灵活的密钥生成算法。算法对内存要求极低，即使在限制较大的环境中也能获得很好的性能。分组和密钥被设计成可以在三种长度中自由选择的形式，AES具有128、192、256位的密钥。802.11规定CCMP中的AES使用的是128位密钥，它的加密块大小也是128位。

​        CCMP：Counter modewith Cipher-block chaining Message authentication code Protocol，计数器模式及密码块链消息认证码协议。它是基于高级加密标准（AES）的CCM（CTR with CBC-MAC）模式。CCM是一种通用的模式，它可以使用在任何成块的加密算法中。CCM模式使用CTR（Counter Mode）提供数据保密，并采用密码块链信息认证码（Cipher-Block Chaining with Message Authentication Code，CBC-MAC）来提供数据认证和完整性服务。

​        CCMP加密时由以下四个输入项组成：

​        （1）明文（Plaintext MPDU）；

​        （2）临时密钥（TK）；

​        （3）封包编号（PN）；

​        （4）密钥标识符（KeyId）；

​        CCMP的加密和解密过程如图2、图3。

![img](http://img.blog.csdn.net/20141028193553095?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvUmlnaHRoZWs=/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/Center)

图2  CCMP加密过程

![img](http://img.blog.csdn.net/20141028193630332?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvUmlnaHRoZWs=/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/Center)

图3  CCMP解密过程

​        下面让我们来看看CCMP帧封装格式，如图4。MAC Header是明文（Plaintext MPDU）原封不动传递过来的，该MAC Header符合802.11MAC标准帧格式。CCMP扩展了原始的MPDU长度到16个octet（注：在网络术语中，用octet表示8 bits），包括8 octets的CCMP头部和8 octets的MIC。CCMP头部由PN、ExtIV、KeyID组成。PN是48位的代表6个octets的数组，在PN中，PN5是最重要的的，PN0是重要性最低的。Data（PDU）是我们需要传输的数据。MIC（Message Integrity Code）是消息完整性检验码，它是针对一组欲保护数据计算出来的散列值，用以防止数据遭人篡改。FCS（Frame Check Sequence）是帧检验序列，处于802.11网络帧的尾部，用来侦测数据是否损坏，若接收端所计算出的FCS与帧中记载的FCS值不同，则可推断出该帧已经损坏并将其丢弃。

![img](http://img.blog.csdn.net/20141028193744791?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvUmlnaHRoZWs=/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/Center)

图4  CCMP帧封装格式

## wifi接入原理——Association

 工作站与基站进行关联，以便获得网络的完全访问权。关联属于一种记录（record keeping）过程，它让分布式系统（Distribution System）得以记录每个移动式工作站的位置，以便将传送给移动式工作站的帧，转送给正确的基站。形成关联之后，基站必须为该移动式工作站在网络上注册，如此一来，发送给该移动式工作站的帧，才会转送至其所属基站。其中一种注册方式是送出一个ARP信号，让该工作站的MAC地址得以跟与基站连接的交换端口形成关联。

​        关联只限于基础型（Infrastructure）网络，在逻辑上等同于在有线网络中插入网线。一旦完成此过程，无线工作站就可以通过分布式系统连接互联网，而其他人也可以经由分布式系统予以回应。IEEE802.11在规格中公开禁止工作站同时与一个以上的基站形成连接。

​        和认证一样，关联过程是由移动式工作站发起的。在此并不需要用到顺序编号，因为关联程序只牵涉到三个步骤。其中所用到的两个帧，被归类为Association管理帧。和单点传播（Unicast）管理帧一样，关联程序的步骤是由一个连接帧及必要的链路层回应所组成：

​        1、一旦移动式工作站与基站完成认证，便可送出关联请求（Association Request）帧。尚未经过身份认证的工作站，会在基站的答复中收到一个解除关联（Deauthenticaton）帧。

​        2、基站随后会对关联请求进行处理。IEEE802.11标准并未规范如何判断是否请允许关联；这因基站的实现而异。较常见的方式是考虑帧暂存所需要的空间大小。以Association Request帧中的聆听间隔（Listen Interval）字段来推算，大致上可以粗略推算出。

​                a. 一旦关联请求获准，基站就会以代表成功的状态代码0及关联识别码（Association ID，简称 AID）来回应。AID本身是数值形式的识别码，在逻辑上则是用来辨识暂存帧所要传递的行动式工作站。

​                b. 关联请求如果失败，就只会返回状态码，并且中止整个过程。

​        3、基站开始为移动式工作站处理帧。在常见的产品中，所使用的分布式系统媒介通常是Ethernet。当基站所收到的帧目的地为与之关联的移动式工作站时，就会将该帧从 Ethernet桥接至无线媒介，如果该移动式工作站处于省电（Power-Saving）状态，则为之暂存帧。在共享式Ethernet中，该帧会被送至所有基站，不过只有正确的基站会进行桥接处理。在交换式Ethernet 里，该工作站的MAC地址得以跟某个特定的交换端口（Switch Port）形成关联。当然，该交换端口必须连接到当前为该工作站提供服务的基站。

![img](http://img.blog.csdn.net/20141117195309994?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvUmlnaHRoZWs=/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/Center)

图1  关联过程

## wifi网络结构

802.11标准协议，如a、b、g、n、ac等

主要介绍涉及智能家居无线网络这块的组成元件，它们分别是：

​        （1）**站点STA（Station）**，所谓的站点，是指具有WIFI通信功能的，并且连接到无线网络中的终端设备，如手机、平板电脑、笔记本电脑等。

​        （2）**接入点AP（Access Point）**，也可称为基站。就是我们平常所说的WIFI热点，更通俗一点，就是我们家里的无线路由器。那么它的作用是什么呢？当我们需要从互联网上获取数据到手机上显示时，那么接入点就相当于一个转发器，将互联网上其他服务器上的数据转发给我们的手机上，当然这只是一个粗略的说法。同时，接入点也属于站点的一种。

​        （3）**基本服务集BSS（Basic Service Set）**，基本服务集的组成情况有两种：a.由一个接入点和若干个站点组成；b.由若干个站点组成，最少两个。为什么这样分呢？主要和802.11网络类型有关。有接入点的，称为基础结构型基本服务集（infrastructure BSS）；无接入点的，称为独立型基本服务集（Independent BSS，简称IBSS），IBSS也有其它的叫法，称为Ad Hoc Network。

​        （4）**服务集识别码SSID（Service Set IDentifier）**，当我们去到一个新地方的时候，开口第一句就是：“请问WIFI账号和密码是多少？”，这里的WIFI账号就是SSID。SSID是通过接入点广播出来了。同时，我们在设置无线路由器时，可修改SSID的名称。

​        （5）**分布式系统DS（Distribution System）**，也有称为传输系统。它通过基站将多个基本服务集连接起来。而DS属于802.11的逻辑元件，当帧（frame）传送至分布式系统时，随即会被送至正确的基站，而后由基站转送至目的站点STA。分布式系统必须负责追踪站点STA实际的位置，以及帧的传送。若要传送帧给某部移动式站点STA，分布式系统必须负责将之传递给服务该移动式站点STA的基站。分布式系统是基站间转送帧的骨干网络，通常称为骨干网络（backbone network）。

​       （6）**扩展服务集ESS（Extented Service Set）**，由一个或者多个基本服务集通过分布式系统串连在一起就构成了ESS。通过ESS，我们可以扩展无线网络的覆盖范围。

​       （7）**门桥（Portal）**，802.11定义的新名词，作用就相当于网桥。用于将无线局域网和有线局域网或者其他网络联系起来。所有来自非802.11局域网的数据都要通过门桥才能进入IEEE 802.11的网络结构。门桥可以使这两种类型的网络实现逻辑上的综合。

​        下面用一张图片来展示构成WIFI网络的组成元件之间的关系，如图1。

​                                             ![img](http://img.blog.csdn.net/20140917204426592?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvUmlnaHRoZWs=/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast)

图1  WIFI网络架构

​        现在我们来聊聊网络类型，网络类型主要是在BSS中进行分类，如上面提到的独立型基本服务集（Independent BSS）和基础结构型基本服务集（infrastructure BSS）

**1、独立型基本服务集**

独立型基本服务集（independentBSS，简称IBSS），如图2左。在IBSS 中，每个站点不需要通过接入点AP就可以与相同IBSS下的任何其他站点彼此建立通信。两者间的距离必须在可以直接通信的范围内。通常，IBSS是由少数几部工作站针对特定目的而组成的临时性网络，最低限度的IBSS，是由两个站点组成的。IBSS有时被称为特设网络（ad hoc network）。

**2、 基础结构型基本服务集**

​        基础结构型基本服务集（infrastructureBSS简称为infrastructure），如图2右。判断是否为基础结构型网络，只要检视是否有基站参与其中。基站负责基础结构型网络所有的传输，包括同一服务区域中所有行动节点之间的通信。位于基础结构型基本服务集的移动式站点，如有必要跟其他移动式站点通信，必须经过两个步骤。首先，由开始对话的站点将帧传递给基站。其次，由基站将此帧转送至目的站点。既然所有通信都必须通过基站，基础结构型网络所对应的基本服务区域就相当于基站的传送范围。虽然这种做法比直接传送耗费较多的资源，不过它有两个主要的优点：

​        （1）基础结构型基本服务集被界定在基站的传输范围。所有移动式站点都必须位于基站的传输范围之内，不过移动式站点之间的距离则无限制。允许移动式站点彼此直接通信虽然可以省下一些频宽，不过代价是相对提高了物理层的复杂度，因为每个站点都必须维护与服务区域中其他站点的邻接关系。

​        （2）基站在基础结构型网络里的作用是协助站点节省电力。基站可以记住有哪些站点处于省电状态，并且为之暂存帧，以电池供电的工作站可以关闭无线收发器，只有在传输或接收来自基站的暂存帧时才会加以开启。

​                                   ![img](http://img.blog.csdn.net/20140917204742669?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvUmlnaHRoZWs=/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast)

​                                                                                                                                            图2  WIFI网络类型

在设计WIFI协议（其实就是802.11协议）时，需要提供一些传输数据和管理的服务。

​        **1、 分布式（Distribution）**

​        只要基础结构型网络里的移动式站点传送任何数据，就会使用这项服务。一旦基站接收到帧。就会使用分布式服务将帧送至目的地。任何行经基站的通信都会通过分布式服务，包括连接至同一部基站的两部移动式站点彼此通信时。

​       **2、 整合（Integration）**

​        整合服务由分布式系统提供；它让分布式系统得以连接至非IEEE 802.11网络。整合功能将因所使用的分布式系统而异，因此除了必须提供的服务，802.11并未加以规范。

​	**3、关联（Association）**

​         之所以能够将帧传递给移动式站点，是因为移动式站点会向基站登记，或与基站产生关联。关联之后，分布式系统即可根据这些登录信息判定哪个移动式站点该使用哪个基站。如果使用强健安全网络协议(robust security network protocol），连接之后才能进行身份认证。在身份认证完成之前，基站会将丢弃来自站点的所有数据。

​       **4、 重新关联（Reassociation）**

​        当移动式站点在同一个扩展服务区域里的基本服务区域之间移动时，它必须随时评估信号的强度，并在必要时切换所连接的接入点。重新关联是由移动式站点所发起，当信号强度显示最好切换关联对象时便会如此做。接入点不可能直接开启重新关联服务。

​        一旦完成重新关联，分布式系统会更新站点的位置纪录，以反映出可通过哪个基站连络上站点。和连接服务一样，在强健安全网络中，除非已经成功完成身份认证，否则来自站点的数据均会被弃置。

​      **5、 解除关联（Disassociation）**

​        要结束现有关联，站点可以利用解除关联服务。当站点启动解除关联服务时，储存于分布式系统的关联数据会随即被移除。一旦解除关联，站点即不再附接在网络上。在站点的关机过程中，解除关联是个礼貌性的动作。不过MAC在设计时已经考虑到站点未正式解除关联的情况。

​	 **6、 身份认证（Authentication）**

​        实体安全防护在有线局域网络安全解决方案中是不可或缺的一部分。网络和连接点（attachment point）受到限制，通常只有位于外围访问控制设备（perimeter access control device）之后的办公区才能加以访问。网络设备可以通过加锁的配线柜（locked wiring closet）加以保护，而办公室与隔间的网络插座只在必要时才连接至网络。无线网络无法提供相同层次的实体保护，因此必须依赖额外的身份认证程序，以保证访问网络的用户已获得授权。身份认证是关联的必要前提，唯有经过身份认证的用户才允许使用网络。

​        站点与无线网络连接的过程中，可能必须经过多次身份认证。关联之前，站点会先以本身的MAC地址来跟基站进行基本的身份认证。此时的身份认证，通常称为802.11身份认证，有别于后续所进行、牢靠而经过加密的用户身份认证。

​       **7、 解除认证（Deauthentication）**

​        解除认证用来终结一段认证关系。因为获准使用网络之前必须经过身份认证，解除认证的副作用就是终止目前的关联。在强健安全网络中，解除认证也会清除密钥信息。

​	**8、 机密性（Confidentiality）**

​        在有线局域网络中，坚固的实体控制可以防止对于数据的绝大部分攻击。攻击者必须能够实际访问网络媒介，才有可能窥视往来的内容。在有线网络中，网线与其他计算资源一样，也要受到实体保护。在设计上，实际访问无线网络，相对而言较为容易，只要使用正确的天线与调制方式就办得到。

​        802.11初次改版时，机密性（confidentiality）服务原本称为私密性（privacy）服务，而且是由目前已经亳无可信度的有线等效加密（Wired Equivalent Privacy， 简称WEP）协议所提供。除了新的加密机制，802.11i另外提供了两种WEP无法解决的关键服务来加强机密性服务，亦即基于用户的身份认证（user-based authentication）以及密钥管理服务。

​	**9、MSDU传递**

​        一个网络如果无法传递数据给接收端，大概也没有什么用。工作站所提供的MSDU（全名为MAC Service Data Unit）传递服务，负责将数据传送给实际的接收端。

​	 **10、传输功率控制（TransmitPower Control，简称 TPC）**

​        TPC是在802.11h中定义的新服务。欧洲标准要求操作于5GHz频段的站点必须能够控制电波的传输功率，避免干扰其他同样使用5 GHz频段的用户。传输功率控制也有助于避免干扰其他无线局域网络。传输距离是传输功率的函数：站点的传输功率愈高，传输距离就愈远，也就愈容易干扰邻近的网络。如果可以将传输功率调到“刚刚好”（just right），就可以避免干扰到邻近的站点。

​	**11、动态频率选择（Dynamic Frequency Selection，简称DFS）**

​         某些雷达系统的作业范围位于5GHz频段。因此，有些管制当局强制要求无线局域网络必须能够检测雷达系统，以及选择未被雷达系统所使用的频率。有些管制当局甚至要求无线局域网络必须能够均衡使用（uniform use）5GHz频段，因此网络必须具备重新配置频道（re-map channels）的能力。

## [用python编写的无线AP扫描器](http://www.cnblogs.com/darkpig/p/5938903.html)

## [python 使用scapy进行ARP扫描](http://blog.csdn.net/jeanphorn/article/details/46408127)





# 网络攻击

网络攻击分类：

张选远http://www.voidcn.com/search/dlugvh

kalilinux课程https://www.easyaq.com/course/15.shtml

https://edu.aqniu.com/；ichunqiu；https://www.easyaq.com/

①主机通信需要查找ARP表，而交换机通信需要查找CAM表（路由器则查找Route表）。

注：ARP表：ip<->mac CAM表：mac<->port （Route表：route<->port）

②交换机基于源MAC地址学习，基于目的MAC地址转发。

③同一局域网内，攻击者可以根据主机的ARP广播请求监听其IP和MAC信息。

注：这里是"被动监听"，跟后面要谈到的"主动扫描"，原理上有区分，这里先埋个坑）

要么"先到先得"，要么"后到优先"。上面提到的ARP和CAM表，就是遵循"后到优先"原则，而后面章节我们会讲到的DHCP表，则遵循"先到先得"原则。

## arp攻击(最不安全的协议)

如果要在TCP/IP协议栈中选择一个**"最不安全的协议"**，那么我会毫不犹豫把票投给ARP协议。我们经常听到的这些术语，包括"网络扫描"、"内网渗透"、"中间人拦截"、"局域网流控"、"流量欺骗"，基本都跟ARP脱不了干系。大量的安全工具，例如大名鼎鼎的Cain、功能完备的Ettercap、操作傻瓜式的P2P终结者，底层都要基于ARP实现。

**ARP原理之广播请求单播回应**，注明：广播根据所在层次可分为二层广播和三层广播，根据发生范围可分为本地广播和定向广播

**ARP基于Ethernet协议，IP协议基于Ethernet协议，它们在Ethernet协议里面有独立的Type类型，前者是0x0806，后者是0x0800**

ARP攻击的危害，黑客采用ARP软件进行扫描并发送欺骗应答，同处一个局域网的普通用户就可能遭受断网攻击、流量被限、账号被窃的危险。由于攻击门槛非常低，普通人只要拿到攻击软件就可以扰乱网络秩序，导致现在的公共网络、家庭网络、校园网、企业内网等变得脆弱无比。（https://www.juhe.cn/news/index/id/2105）(https://zhuanlan.zhihu.com/p/28818627)

**稳健的ARP嗅探/渗透工具，能在短时间内高并发做网络扫描（例如1秒钟成千上百的数据包），能够持续对外发送欺骗包。**

PC1和PC2的通信数据流被PC3拦截，形成了典型的"**中间人攻击**"。那么，一旦被攻击并拦截，攻击者能做什么，普通用户又会遭受什么损失？这里给大家举几个常见的例子=>

①攻击者既然操控了数据流，那么直接断开通信是轻而易举的，即**"断网攻击"**，例如，PC1发给PC2的数据在PC3这里可以直接丢弃，而如果这里的PC2是一台出口路由器（无线路由器），那就意味着PC1直接无法连上互联网。

②"断网攻击"显然容易被发现，而且比较"残忍"，所以就有了更加常见的应用-**"限速"**。例如，在宿舍上网突然很慢，在网吧上网突然打不开网页，如果这个网络没有安全防御，那么很有可能有"内鬼"。

③其实无论是"断网攻击"还是"限速"，整体还是比较"善良"，因为这里流量里面的核心数据还没有被"提取"出来。如果攻击者是一名真正的黑客，他的目的一定不会这么无聊，因为内网流量对于黑客是没有太大价值的，而只有**"用户隐私"**，例如常见网站的登录账号密码，这些才是最有价值的。**http（web应用），常见的还有telnet、ftp、pop3/smtp/imap（邮箱）**等应用，都很容易泄露密码。

### **常见ARP渗透工具与底层原理分析**

①无毒无害型的**仅具备ARP扫描**功能，用来发现内网主机；例如Metasploit里面的arping/arpscan相关模块；

②**ARP扫描+流量控制**（限速或限制能上哪些网站和应用）；例如Windows下的P2P终结者；

③**ARP扫描+账号窃取**（网站、邮箱、各种）；最强的莫过于Windows下的Cain，当然还有跨平台的Ettercap（需配合其他工具）；

10.1.20.0/24,Hacker只知道自己的IP信息，例如IP地址是10.1.20.253，网关地址是10.1.20.254，而这个局域网的其他设备是什么？有多少台？地址分布是多少？Hacker都不知道，接下来怎么办呢？是不是要直接发动ARP攻击了？

进行基本的**扫描和踩点**。这个时候通过ARP工具对这个WiFi网络进行扫描,在ARP应答信息里面，除了IP地址和MAC信息，我们还能看到相关的设备厂商信息，例如cisco、meizu、apple、xiaomi等，这其实就是依靠MAC地址前面24位的**OUI（机构唯一标识符）**来识别的。Wireshark或扫描器能够帮我们将OUI转为对应的厂商（还有一些扫描器基于Netbios协议，还能找到电脑的主机名）.通过扫描，我们已经知道了整个网络的主机信息，例如20.254对应cisco，应该是路由器，20.248对应apple，是苹果手机，20.249对应xiaomi，是小米手机，以此类推。

根据之前的信息，我们知道00:08:ca:86:f8:0f其实就是hacker的mac地址，并且对应的真正的IP地址应该是10.1.20.253。而这里很明显是**hacker在欺骗局域网其他主机，它对外声称：自己就是"所有人"**。尤其是上面标红的主机，我们已经知道是小米、思科、苹果等设备，但是hacker都声明是自己！这样做的意义在于覆盖掉其他主机的ARP缓存表信息，并生成错误的ARP映射，最终将通信流量交给hacker。

当然，还有另外一种ARP欺骗的做法：**hacker告诉所有人，自己就是网关**。因为其他主机访问互联网必经之路便是网关（出口路由器/无线路由器），通过这种方式，同样可以截取到用户数据流，这里给出另外一个网络的实现过程=>**Hacker欺骗主机Honhai，告诉它：我就是网关（10.1.1.254）**

①ARP缓存表基于"后到优先"原则，IP与MAC的映射信息能被覆盖；

②ARP攻击基于伪造的ARP回应包，黑客通过构造"错位"的IP和MAC映射，覆盖主机的ARP表（也被称为"ARP毒化"），最终截取用户的数据流；

③一旦遭受ARP攻击，账号密码都可能被窃取（如果通信协议不是加密的）；

④通过Wireshark数据包分析，我们掌握了真实网络中ARP底层攻击原理及数据包组成。



### [arp-scan 发现本地网络中的隐藏设备](http://topspeedsnail.com/arp-scan-find-network-devices/)



## 常见局域网攻击类型

### 1.广播风暴

在局域网中，广播风暴是指当大量的广播数据存在于局域网中且无法处理时，这些数据就会占有大量的网络宽带，从而导致正常的数据无法被处理，使得局域网的数据处理性能下降，严重的话还会造成局域网彻底瘫痪。广播风暴产生的原因有多种，常见的有网线短路、网络中存在环路、傻瓜式换机、网卡损坏以及蠕虫病毒等。

**广播风暴**指数据帧形成环路，而帧头中无ttl的结构，所以帧始终有效，由于广播没有特定目标地址，所以hub/swtich会永远转发下去。 广播风暴的产生有多种原因，如**蠕虫病毒、交换机端口故障、网卡故障、链路冗余没有启用生成树协议、网线线序错误或受到干扰**等。从目前来看，蠕虫病毒和arp攻击是造成网络广播风暴最主要的原因。虽说如今网络广播风暴已经很少见了，但在一些使用集线器的网络中仍然非常常见。 

①网线短路引发广播风暴

网线短路引发广播风暴是指当网线发生短路时，交换机将会接收到大量不符合分装原则的数据包，从而造成交换机工作繁忙，数据包无法及时转发，使得局域网中出现数据丢失的现象，从而引发广播风暴。网线短路通常是由于网线表面有磨损或者网线的水晶头质量问题引起的。解决网络广播风暴最快捷的方法是给集线器断电然后上电启动即可，但这只是治标不治本的方法，要彻底解决，最好使用交换机设备，并划分vlan、通过端口控制网络广播风暴。否则，如果广播风暴是由于网卡损坏所致，要从上百台计算机找出故障计算机简直就是大海捞针，那将是一场噩梦。 

②网络中存在环路引发广播风暴

当局域网中存在环路时，就会造成每一个数据包都在局域网中重复广播，从而引发广播风暴。要消除这种网络循环连接带来的广播风暴可以使用STP协议（生成树协议），以局域网中一台交换机为节点生成一棵转发树，让所有的数据包都只在这棵树的路径上传输，就不会产生广播风暴了（因为树没有环路），但由于STP算法开销太大，因此交换机默认未启用该协议。

③傻瓜机交换机引发广播风暴

傻瓜交换机是指那些不具备生成树协议功能、无法自动切断级联交换机之间多余端口的交换机。如果在同一个傻瓜式交换机的不同端口或傻瓜交换机之间有多余连接时，就会导致网络中存在环路，进而导致网络广播风暴。

④网卡损坏引发广播风暴

当局域网中某一台计算机的网卡损坏时，由于该计算机与交换机相连接，从而导致它们之间不断地发送广播数据包，从而引发广播风暴。还有一种可能是因为计算机网卡与交换机形成了回路，广播数据包无法及时发送出去而造成广播风暴。

⑤蠕虫病毒引发广播风暴

当局域网中某台计算机感染了Funlove、震荡波、RPC等蠕虫病毒时，它会导致当前计算机网卡的发送数据包和接收数据包快速增加，并通过网络传播，损耗大量的网络宽带，引发网络堵塞，从而导致广播风暴。



```
引起网络广播风暴的几种原因
1、网络设备原因：我们经常会有这样一个误区，交换机是点对点转发，不会产生广播风暴。在我们购买网络设置时，购买的交换机，通常是智能型的Hub，却被奸商当做交换机来卖。这样，在网络稍微繁忙的时候，肯定会产生广播风暴了。hub和局域网交换机的区别在于，交换机在转发时会检查局域网内的mac地址，如果地址表中没有对应的mac，发出广播帧寻址，如果有对应mac的终端，终端会回应，并且将mac地址加入本身的路由表，并将数据包转发，如果未收到回应则不进行数据转发，直接丢弃；而hub在收到数据包后不检查mac地址，转发给局域网内接收端口以外的所有端口，则容易产生广播风暴。
2.网线短路导致广播风暴
压制网线时没有做好，或者网线表面有磨损导致短路，会引起交换机的端口阻塞，因为现在交换机大多都使用存储转发技术，它的工作原理是对某一段数据包进行分析判断寻址，并进行转发，在发出前均存储在交换机的缓冲区内，当网线发生短路时，该交换机将接收到大量的不符合分装原则的包，造成交换机处理器工作繁忙，数据包来不及转发，从而导致缓冲区溢出产生丢包现象，导致广播风暴。
   对策：使用mrgt等流量查看软件可以查看出现短路的端口，如果交换机是可网管的，也可以通过逐个封闭端口来进行处理查找，进而找到有问题的网线。找到短路的网线后，更换一根网线。
2、网卡损坏：如果网络机器的网卡损坏，也同样会产生广播风暴。损坏的网卡，不停向交换机发送大量的数据包，产生了大量无用的数据包，产生了广播风暴。由于网卡物理损坏引起的广播风暴，故障比较难排除，由于损坏的网卡一般还能上网，我们一般借用Sniffer局域网管理软件，查看网络数据流量，来判断故障点的位置。 
    当交换机有一个端口传输速率非常缓慢，最后导致整台交换机都慢下来，如果交换机是可网管型的，可通过控制台检查交换机的状态，如发现交换机的缓冲池增长的非常快，达到90%乃至更多。一般来说，这种原因是因为交换机与所连接的计算机之间发送大量的广播造成，通常是因为连接该计算机的网卡损坏，导致不断的发送广播包造成，也有可能是因为网卡与交换机形成了回路，广播包阻塞不能及时发出。
   对策：可将其他正常的计算机接到有问题的端口 上，如果故障解决，则是原先计算机的网卡损坏或网络故障所致，更换新网卡并检测线路及网络配置即可解决。如果故障依旧，则说明原先计算机的网卡未损坏，可能是交换机的该端口已损坏，检查该端口的指示灯，如确认是该端口损坏，应及时将交换机送修或者将计算机连接到其他端口，注意，不要擅自修理交换机，否则损坏交换机得不偿失。
3、网络环路：曾经在一次的网络故障排除中，发现一个很可笑的错误，一条双绞线，两端插在同一个交换机的不同端口上，导致了网络性能急骤下降，打开网页都非常困难。这种故障，就是典型的网络环路。网络环路的产生，一般是由于一条物理网络线路的两端，同时接在了一台网络设备中。

当网络中存在环路，就会造成每一帧都在网络中重复广播，引起广播风暴。要消除这种网络循环连接带来的网络广播风暴可以使用stp协议（生成树协议），以网络中一台交换机为节点生成一棵转发树，这样所有的数据都只在这棵树所只是的路径上传输，就不会产生广播风暴——因为树没有环路。但因为stp算法开销太大，交换机默认都没启用该协议。
   对策：在接入层启用树生成协议，或者在诊断故障时打开树生成协议，以便协助确定故障点。在广播风暴发生时，应首先了解发生故障前网络的改动，建立完善的网络文 档资料，包括：网络布线图、ip地址和mac地址对应表等，现在可以通过局域网工具软件来扫描获取这些信息。
   
傻瓜交换机拓扑环引发广播风暴
   可网管的交换机由于具备树生成协议功能，可自动切断级联交换机之间的冗余端口，避免网路偶拓扑环的产生，但这个功能，傻瓜交换机并不具备。在同一傻瓜交换机上的不同端口，或傻瓜交换机之间有冗余的连接，就导致网络拓扑环的发生，进而导致网络广播风暴，造成网络通讯失败。
   对策：用于级联交换机的跳线应当做一些特殊标记，最好选择使用不同颜色的跳线，与其他普通跳线相区别。

4、网络病毒：目前，一些比较流行的网络病毒，Funlove、震荡波、RPC等病毒，一旦有机器中毒后，会立即通过网络进行传播。网络病毒的传播，就会损耗大量的网络带宽，引起网络堵塞，引起广播风暴。

5、黑客软件的使用：目前，一些上网者，经常利用网络执法官、网络剪刀手等黑客软件，对网吧的内部网络进行攻击，由于这些软件的使用，网络也可能会引起广播风暴。

对策：激活防止arp病毒攻击。在路由器中打开该选项，或者为计算机安装防范arp攻击的软件，如360安全卫士的局域网arp攻击拦截的保护功能等；对 局域网内每一台计算机绑定网管的ip和其mac地址；给每一台计算机安装最新补丁，最好通过在局域网内架设补丁服务器（wsus）来确保每一台计算机都能 打上最新的补丁程序，如关键更新、安全更新和service pack；给系统管理员帐户设置足够复杂的强密码；经常更新杀毒软件的病毒库和网络软件防火墙的规则库；关闭一些不需要的服务；不随意点击聊天工具里出现 的超链接、邮件的附件和来历不明的程序。

6.网络视频引发广播风暴
       部分视频网络传输设备为了便于网络视频点播，常常采用udp的方式，以广播数据包的形式对外进行发送，如果在专用网络中也使用这种方式，很容易引发广播风暴，导致网络阻塞，因此必须通过相关设置来杜绝这类故障。
   对策：将视频网络传输设备所连接的交换机端口进行一些设置，对设备本身的网络传输模式以及传送协议类型进行更改，消除网络广播风暴。

总结：
要解决广播风暴的问题，可以从以下几个方面入手：
   一、在局域网中安装wsus补丁服务器，保证局域网所有计算机都能及时打上最新的补丁。
   二、最好在局域网内安装网络版的防毒服务器，如无条件，起码也得保证单机版的防毒软件的病毒库是经常更新的。
   三、检查每一台计算机的网卡、网线和交换机的每一个端口，检查是否有故障。
   四、当广播风暴发生时，观察交换机的指示灯不啻为很好的方法，可直接观察网络连通性及网络流量。
       要避免广播风暴，可以采用恰当划分vlan、缩小广播域、隔离广播风暴，还可在千兆以太网口上启用广播风暴控制，最大限度地避免网络再次陷入瘫痪。当端口接受到大量的广播、单播或组播的包时，就会发生广播风暴。转发这些包会导致网络速度变慢或超时，在交换机上借助对端口的广播风暴控制可以有效避免硬件损坏或链路故障导致的广播风暴的网络瘫痪。

   从笔者的实际经验来看，90%以上的网络广播风暴是病毒所致，因此，在局域网中配备防病毒系统，购置ids入侵检测系统、网络流量检测工具等，以加强网络 病毒的防治，加强对网络线路运行状态的监控，及时发现和处理网络上的异常流量和病毒攻击等问题，并制定计算机安全管理制度，确保网络线路的正常运行。

```











### 2.ARP欺骗攻击

ARP欺骗攻击是一种基于ARP协议的局域网攻击方式，该种攻击方式利用了ARP协议中“局域网中的网络流通是按照MAC地址传输”这一特点而产生的。若要了解ARP欺骗攻击，则首先需要了解ARP协议的工作原理。

①ARP协议的工作原理

当计算机A向计算机B发送数据时，计算机A会查询本地ARP缓存表，找到计算机B的MAC地址后再传数据包；如果未找到，则广播A的一个ARP请求数据（携带计算机A的IP地址la——物理地址Ma），请求IP地址为lb的计算机B回答物理地址Pb，局域网中所有计算机（包括计算机B）都收到ARP请求数据，但只有计算机B能识别自己的IP地址，于是向计算机A发送一个ARP响应数据，其中包含有计算机B的MAC地址。计算机A接收到计算机B的应答后更新本地ARP缓存表，然后使用这个MAC地址向计算机B发送数据。ARP协议并不止在发送了ARP请求才接收ARP应答。当计算机接收到ARP应答数据时就会对本地ARP缓存表进行更新，存储应答中的IP和MAC地址。因此，当局域网中某台计算机C向计算机A发送一个自己伪造的ARP应答数据时，而如果这个应答时计算机C冒充计算机B伪造的（IP地址为计算机B的IP地址，而MAC地址伪造计算机B的MAC地址），则当计算机A接收到计算机C伪造的ARP应答数据后，就会更新本地的ARP缓存。这样在计算机A看了计算机B的IP地址没有变，但计算机B的MAC地址已经不是原来那个。由于局域网的网络流通不是根据IP地址进行，而是按照MAC地址进行传输的，所以，那个伪造出来的MAC地址在计算机A上被改变成了一个不存在的MAC地址，这样就会造成网络不通，导致计算机A不能Ping通计算机B！这就是一个简单ARP欺骗。ARP欺骗攻击是黑客常用的攻击手段之一。常见的ARP欺骗攻击分为两种，一种是对路由器ARP表的欺骗攻击，另一种是对内网计算机网关的欺骗攻击。

①对路由器ARP表的欺骗攻击

这种ARP欺骗攻击的原理是截获网关数据。它发给路由器一系列错误的内网MAC地址，并按照一定的频率不断进行，使真实的地址信息无法通过更新保存在路由器中。结果路由器所有数据只能发送给错误的MAC地址，造成正常的计算机无法收到信息。

②对内网计算机网关的欺骗攻击

这种ARP欺骗攻击的原理是伪造网关，即建立假网关，让被它欺骗的计算机向假网关发送数据，而不是通过正常的路由器途径上网，使得网内的计算机无法正常上网。

### 3.IP冲突攻击

IP地址冲突是指在同一个局域网中，如果有两台计算机同时使用了相同的IP地址，或者其中一台计算机已经通过DHCP获取了一个IP地址，同时又有其他计算机被手动分配了与此相同的IP地址的现象。一旦出现IP地址冲突，则其中一台计算机将无法正常上网。IP冲突攻击只是ARP攻击的一部分，该种攻击方式能够在局域网中产生大量的ARP通信，造成局域网闭塞。黑客只要持续不断地发出伪造的ARP响应数据，就能更改目标计算机ARP缓存中的IP/MAC地址信息，造成目标计算机上不断显示IP地址冲突，使得目标计算机无法上网。



防御广播风暴可以采用VLAN技术，使用高质量的网线和网络设备、避免局域网中出现环路以及安装杀毒软件。

防御ARP欺骗用户可以采用绑定IP/MAC地址列表的方法进行防御，还可以使用360木马防火墙来防御ARP欺骗攻击。

防御IP冲突攻击可以采用在路由器中捆绑IP地址与MAC地址，使得除绑定的IP地址外，任何地址都无法接入当前局域网，从而防御IP冲突攻击。



## 常见八大网络攻击地图软件供用商

**1. Norse** 

可能最著名的网络攻击地图，就是Norse制作的那个了。Norse是一家在过去几年里问题频出的安全公司。关于自家地图上呈现的数据，Norse称，显示的攻击“基于Norse蜜罐基础设施实时流量的一个小子集。”

很有趣的一点是，公司企业可以在显示的时候把自己的标志也加到地图上。<http://map.norsecorp.com/#/>

**2. 卡巴斯基** 

最佳视觉与互动显示奖，归属卡巴斯基“网络威胁实时地图”——附加全局旋转和缩放功能。

卡巴斯基地图上显示的攻击，来自按需扫描和按访问扫描，以及Web和电子邮件检测。但其实时展示的实时性，尚不清楚。<https://cybermap.kaspersky.com/> 

**3. 飞塔** 

飞塔的网络攻击地图很像Norse的那个，似乎显示的是已记录事件的回放。显示攻击的同时，屏幕左下角还会出现循环播放的各类统计数据。产品文档中称，飞塔客户还可以建立自己的地图。<https://threatmap.fortiguard.com/>

**4. Check Point Software** 

Checkpoint Software 的“威胁云”(ThreatCloud)，展示每天太平洋标准时间午夜零点(12:00 a.m)就重置的历史数据。该地图比Norse的更直观，但基本结构是一样的。除了看回放，顶级攻击者和目标还可以看历史记录，有月统计数据和周统计数据。<https://threatmap.checkpoint.com/ThreatPortal/livemap.html>

**5. 火眼** 

火眼的网络攻击地图缺乏其他地图所呈现的细节，保持简单明了。它追踪历史数据，并按行业和攻击者归属地划分。展示的数据“基于真实攻击数据的一个子集，进行了视觉效果优化。”<https://www.fireeye.com/cyber-map/threat-map.html>

**6. Arbor Networks** 

Arbor Networks 的网络攻击地图是与谷歌Ideas合作的混合地图。该“数字攻击地图”(Digital Attack Map)以来自 Arbor ATLAS 威胁情报系统的数据跟踪DDoS攻击。原始数据源自300多家ISP客户和130Tbps全球流量。该地图可视化DDoS攻击，并允许按规模和类型筛选。<http://www.digitalattackmap.com/>

**7. 趋势科技** 

趋势科技的“僵尸网络连接仪表板”(Botnet Connection Dashboard)，是跟踪全球僵尸网络（及其目标）所用C&C（命令与控制）服务器的小型精简网络攻击地图。其所显示数据的年龄未知，但历史数据可回溯14天。<https://botnet-cd.trendmicro.com/>

**8. 阿卡迈** 

阿卡迈实时监视器不是一个典型的网络攻击地图，但因为它确实除了互联网流量之外也跟踪攻击，所以就包含了进来。一旦加载，便可以看到世界上哪些地区流量规模最大；另一个标签页中，可以看到哪些地区正在经受最多的攻击。阿卡迈称，这些数据是实时呈现的。<https://www.akamai.com/us/en/solutions/intelligent-platform/visualizing-akamai/real-time-web-monitor.jsp>



## 常见网络攻击

概括来说分四大类：服务拒绝攻击、利用型攻击、信息收集型攻击、假消息攻击。 

### 1.服务拒绝攻击 

　　服务拒绝攻击企图通过使你的服务计算机崩溃或把它压跨来阻止你提供服务，服务拒绝攻击是最容易实施的攻击行为，主要包括： 

#### （1）死亡之ping(ping of death) 

　　概览：由于在早期的阶段，路由器对包的最大尺寸都有限制，许多操作系统对TCP/IP栈的实现在ICMP包上都是规定64KB，并且在对包的标题头进行读取之后，要根据该标题头里包含的信息来为有效载荷生成缓冲区，当产生畸形的，声称自己的尺寸超过ICMP上限的包也就是加载的尺寸超过64K上限时，就会出现内存分配错误，导致TCP/IP堆栈崩溃，致使接受方当机。 

　　防御：现在所有的标准TCP/IP实现都已实现对付超大尺寸的包，并且大多数防火墙能够自动过滤这些攻击，包括：从windows98之后的windows,NT(service pack 3之后)，linux、Solaris、和Mac OS都具有抵抗一般ping ofdeath攻击的能力。此外，对防火墙进行配置，阻断ICMP以及任何未知协议，都讲防止此类攻击。 

#### （2）泪滴(teardrop) 

　　概览：泪滴攻击利用那些在TCP/IP堆栈实现中信任IP碎片中的包的标题头所包含的信息来实现自己的攻击。IP分段含有指示该分段所包含的是原包的哪一段的信息，某些TCP/IP（包括servicepack 4以前的NT）在收到含有重叠偏移的伪造分段时将崩溃。 

　　防御：服务器应用最新的服务包，或者在设置防火墙时对分段进行重组，而不是转发它们。 

#### （3）UDP洪水(UDP flood) 

　　概览：各种各样的假冒攻击利用简单的TCP/IP服务，如Chargen和Echo来传送毫无用处的占满带宽的数据。通过伪造与某一主机的Chargen服务之间的一次的UDP连接，回复地址指向开着Echo服务的一台主机，这样就生成在两台主机之间的足够多的无用数据流，如果足够多的数据流就会导致带宽的服务攻击。 

　　防御：关掉不必要的TCP/IP服务，或者对防火墙进行配置阻断来自Internet的请求这些服务的UDP请求。 

#### （4）SYN洪水(SYN flood) 

　　概览：一些TCP/IP栈的实现只能等待从有限数量的计算机发来的ACK消息，因为他们只有有限的内存缓冲区用于创建连接，如果这一缓冲区充满了虚假连接的初始信息，该服务器就会对接下来的连接停止响应，直到缓冲区里的连接企图超时。在一些创建连接不受限制的实现里，SYN洪水具有类似的影响。 

　　防御：在防火墙上过滤来自同一主机的后续连接。 

　　未来的SYN洪水令人担忧，由于释放洪水的并不寻求响应，所以无法从一个简单高容量的传输中鉴别出来。 

#### （5）Land攻击 

　　概览：在Land攻击中，一个特别打造的SYN包它的原地址和目标地址都被设置成某一个服务器地址，此举将导致接受服务器向它自己的地址发送SYN-ACK消息，结果这个地址又发回ACK消息并创建一个空连接，每一个这样的连接都将保留直到超时掉，对Land攻击反应不同，许多UNIX实现将崩溃，NT变的极其缓慢（大约持续五分钟）。 

　　防御：打最新的补丁，或者在防火墙进行配置，将那些在外部接口上入站的含有内部源地址滤掉。（包括10域、127域、192.168域、172.16到172.31域） 

#### （6）Smurf攻击 

　　概览：一个简单的smurf攻击通过使用将回复地址设置成受害网络的广播地址的ICMP应答请求 （ping）数据包来淹没受害主机的方式进行，最终导致该网络的所有主机都对此ICMP应答请求作出答复，导致网络阻塞，比pingof death洪水的流量高出一或两个数量级。更加复杂的Smurf将源地址改为第三方的受害者，最终导致第三方雪崩。 

　　防御：为了防止黑客利用你的网络攻击他人，关闭外部路由器或防火墙的广播地址特性。为防止被攻击，在防火墙上设置规则，丢弃掉ICMP包。 

#### （7）Fraggle攻击 

　　概览：Fraggle攻击对Smurf攻击作了简单的修改，使用的是UDP应答消息而非ICMP 

　　防御：在防火墙上过滤掉UDP应答消息 

#### （8）电子邮件炸弹 

　　概览：电子邮件炸弹是最古老的匿名攻击之一，通过设置一台机器不断的大量的向同一地址发送电子邮件，攻击者能够耗尽接受者网络的带宽。 

　　防御：对邮件地址进行配置，自动删除来自同一主机的过量或重复的消息。 

#### （9）畸形消息攻击 

　　概览：各类操作系统上的许多服务都存在此类问题，由于这些服务在处理信息之前没有进行适当正确的错误校验，在收到畸形的信息可能会崩溃。 

　　防御：打最新的服务补丁。 

### 2.利用型攻击 

　　利用型攻击是一类试图直接对你的机器进行控制的攻击，最常见的有三种： 

（1）口令猜测 

　　概览：一旦黑客识别了一台主机而且发现了基于NetBIOS、Telnet或NFS这样的服务的可利用的用户帐号，成功的口令猜测能提供对机器控制。 

　　防御：要选用难以猜测的口令，比如词和标点符号的组合。确保像NFS、NetBIOS和Telnet这样可利用的服务不暴露在公共范围。如果该服务支持锁定策略，就进行锁定。 

（2）特洛伊木马 

　　概览：特洛伊木马是一种或是直接由一个黑客，或是通过一个不令人起疑的用户秘密安装到目标系统的程序。一旦安装成功并取得管理员权限，安装此程序的人就可以直接远程控制目标系统。 

　　最有效的一种叫做后门程序，恶意程序包括：NetBus、BackOrifice和BO2k,用于控制系统的良性程序如：netcat、VNC、pcAnywhere。理想的后门程序透明运行。 

　　防御：避免下载可疑程序并拒绝执行，运用网络扫描软件定期监视内部主机上的监听TCP服务。 

（3）缓冲区溢出 

　　概览：由于在很多的服务程序中大意的程序员使用象strcpy(),strcat()类似的不进行有效位检查的函数，最终可能导致恶意用户编写一小段利用程序来进一步打开安全豁口然后将该代码缀在缓冲区有效载荷末尾，这样当发生缓冲区溢出时，返回指针指向恶意代码，这样系统的控制权就会被夺取。 

　　防御：利用SafeLib、tripwire这样的程序保护系统，或者浏览最新的安全公告不断更新操作系统。 

### 3.信息收集型攻击 

　　信息收集型攻击并不对目标本身造成危害，如名所示这类攻击被用来为进一步入侵提供有用的信息。主要包括：扫描技术、体系结构刺探、利用信息服务 

（1）扫描技术 

　　地址扫描 

　　概览：运用ping这样的程序探测目标地址，对此作出响应的表示其存在。 

　　防御：在防火墙上过滤掉ICMP应答消息。 

　　端口扫描 

　　概览：通常使用一些软件，向大范围的主机连接一系列的TCP端口，扫描软件报告它成功的建立了连接的主机所开的端口。 

　　防御：许多防火墙能检测到是否被扫描，并自动阻断扫描企图。 

　　反响映射 

　　概览：黑客向主机发送虚假消息，然后根据返回“hostunreachable”这一消息特征判断出哪些主机是存在的。目前由于正常的扫描活动容易被防火墙侦测到，黑客转而使用不会触发防火墙规则的常见消息类型，这些类型包括：RESET消息、SYN-ACK消息、DNS响应包。 

　　防御：NAT和非路由代理服务器能够自动抵御此类攻击，也可以在防火墙上过滤“hostunreachable”ICMP应答。 

　　慢速扫描 

　　概览：由于一般扫描侦测器的实现是通过监视某个时间桢里一台特定主机发起的连接的数目（例如每秒10次）来决定是否在被扫描，这样黑客可以通过使用扫描速度慢一些的扫描软件进行扫描。 

　　防御：通过引诱服务来对慢速扫描进行侦测。 

（2）体系结构探测 

　　概览：黑客使用具有已知响应类型的数据库的自动工具，对来自目标主机的、对坏数据包传送所作出的响应进行检查。由于每种操作系统都有其独特的响应方法（例NT和Solaris的TCP/IP堆栈具体实现有所不同），通过将此独特的响应与数据库中的已知响应进行对比，黑客经常能够确定出目标主机所运行的操作系统。 

　　防御：去掉或修改各种Banner，包括操作系统和各种应用服务的，阻断用于识别的端口扰乱对方的攻击计划。 

（3）利用信息服务 

　　DNS域转换 　 

　　概览：DNS协议不对转换或信息性的更新进行身份认证，这使得该协议被人以一些不同的方式加以利用。如果你维护着一台公共的DNS服务器，黑客只需实施一次域转换操作就能得到你所有主机的名称以及内部IP地址。 

　　防御：在防火墙处过滤掉域转换请求。 

　　Finger服务 

　　概览：黑客使用finger命令来刺探一台finger服务器以获取关于该系统的用户的信息。 

　　防御：关闭finger服务并记录尝试连接该服务的对方IP地址，或者在防火墙上进行过滤。 

　　LDAP服务 

　　概览：黑客使用LDAP协议窥探网络内部的系统和它们的用户的信息。 

　　防御：对于刺探内部网络的LDAP进行阻断并记录，如果在公共机器上提供LDAP服务，那么应把LDAP服务器放入DMZ。 

### 4.假消息攻击 

　　用于攻击目标配置不正确的消息，主要包括：DNS高速缓存污染、伪造电子邮件。 

（1）DNS高速缓存污染 

　　概览：由于DNS服务器与其他名称服务器交换信息的时候并不进行身份验证，这就使得黑客可以将不正确的信息掺进来并把用户引向黑客自己的主机。 

　　防御：在防火墙上过滤入站的DNS更新，外部DNS服务器不应能更改你的内部服务器对内部机器的认识。 

（2）伪造电子邮件 

　　概览：由于SMTP并不对邮件的发送者的身份进行鉴定，因此黑客可以对你的内部客户伪造电子邮件，声称是来自某个客户认识并相信的人，并附带上可安装的特洛伊木马程序，或者是一个引向恶意网站的连接。 

　　防御：使用PGP等安全工具并安装电子邮件证书



## 介绍三种网络安全攻击手段

分别是：跨站脚本攻击(XSS)攻击、跨站请求伪造(CSRF)攻击、SQL注入攻击。

### 1、XSS攻击

应该算是最普遍的应用程序层攻击之一，攻击的目的是盗走客户端 cookies，或者任何可以用于在 Web 站点确定客户身份的其他敏感信息。

用这三种方式可以保护站点不受 XSS 攻击：

1.执行内部的输入过滤（有时候称为输入清洁设备）。对于内部书写的每个脚本中的每个用户输入 —— 参数或 HTTP 头，都应该应用高级的 HTML 标签（包括 JavaScript 代码）过滤。举例来说，应该过滤 `<script>` 标签。该方法有一些严重的不利因素：
\* 要求应用程序的编程人员非常精通安全。

\* 要求编程人员覆盖所有可能的输入来源（查询参数、`POST` 请求的 body 参数、HTTP 头）。* 它不能抵御第三方脚本或服务器中的安全漏洞。举例来说，它不能防御 Web 服务器错误页面中的问题（通常显示了资源的路径）。

2、执行“输出过滤”，换句话说，当发回给浏览器时过滤用户数据，而不是当被脚本接收时。一个很好的示例是通过一个脚本将输入数据插入到数据库中，然后再从数据库呈现数据。在这种情况下，重要的是不向原始的输入字符串应用过滤，而只向输出版本应用过滤。这种方法的缺陷类似于对输入过滤的缺陷。

3、通过安装第三方应用程序防火墙，防火墙在 XSS 攻击到达 Web 服务器和易受攻击的脚本之前拦截它们，并阻塞它们。不论是来自内部应用程序的脚本或路径、第三方脚本，或根本不描述资源的脚本（举例来说，用来引起来自服务器的 404 页面响应的脚本），应用程序防火墙都可以以一般的方式覆盖所有输入方法（包括路径和 HTTP 头）。对于每个输入源，应用程序防火墙根据各种 HTML 标签模式和 JavaScript 模式检查数据。如果匹配成功，就拒绝该请求，恶意的输入不会到达服务器。

 

### 2、SQL注入攻击

跟XSS攻击有点类似，以SQL语句作为用户输入，从而达到查询/修改/删除数据的目的。对于SQL注入攻击的详细介绍，可以上网搜索《[SQL注入攻防入门详解](http://www.cnblogs.com/heyuquan/archive/2012/10/31/2748577.html)》这篇文章，讲得比较详细了。

防止SQL注入攻击：

\* 类型检查：对接收数据有明确要求的，在方法内进行类型验证。如数值型

\* 长度验证：要进行必要的注入，其语句也是有长度的。所以如果你原本只允许输入10字符，

那么严格控制10个字符长度，一些注入语句就没办法进行。

\* 关键字过滤：这个门槛比较高，因为各个数据库存在关键字，内置函数的差异，所以对

编写此函数的功底要求较高

* 参数化查询：在使用参数化查询的情况下，数据库服务器不会将参数的内容视为SQL指令的一部份来处理，而是在数据库完成 SQL 指令的编译后，才套用参数运行，因此就算参数中含有具有损的指令，也不会被数据库所运行

 

### 3、CSRF攻击

   CSRF攻击是黑客借助受害者的 cookie 骗取服务器的信任，但是黑客并不能拿到 cookie，也看不到cookie的内容（跟XSS攻击的区别）。另外，对于服务器返回的结果，由于浏览器同源策略的限制，黑客也无法进行解析。因此，黑客无法从返回的结果中得到任何东西，他所能做的就是给服务器发送请求，以执行请求中所描述的命令，在服务器端直接改变数据的值，而非窃取服务器中的数据。所以，我们要保护的对象是那些可以直接产生数据改变的服务，而对于读取数据的服务，则不需要进行 CSRF 的保护。

\* 验证Http Referer字段

* 在请求地址中添加token并验证





